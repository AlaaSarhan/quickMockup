<!--
TODO:
* editieren to jquery UI Plungin oder:
* Change canvas size
* set up simple, universal markup that helps to style tables etc. via markdown

DONE:
* löschen
* Rudmentäres Editieren
* Drag/Drop schachteln
* Drag Drop
* Resize


--->


<!DOCTYPE html>
<html>

<head>
		<title>Edittests</title>
		<meta charset="UTF-8">
		<meta name="description" content="">
		<meta name="keywords" content="">
		<script src="jquery.js"></script>
		<script src="jquery-ui.js"></script>
		<script src="showdown.js"></script>
		<script src="showdownUIExtensions.js"></script>
		<script src="mousetrap.js"></script>

		<script src="jqUiEditMD2HTML.js"></script>


		<link href="jquery-ui.css" rel="stylesheet">


		<style>
				body{
			padding:0;
			margin:0;

		}

		.mockElement {

			width: 50px;
			height: 50px;
			position: absolute;
		}

		.editableArea>p{
			margin: 0 0 0 0;
			padding: 0 0 0 0;
		}

		.newMockElement{
			/*background: gray;*/
			width: 50px;
			height: 50px;
			/*position: absolute; not needed*/
		}

			.bigmockElement{
				width: 100px;
				height: 100px;
				position: absolute;
				background: #a29eb2;
			}

			#container{
				position: absolute;
				margin:0 0 0 10vw;
				padding:0 0 0 0;
				width:90vw;
				height:100vh;

			}

			#widgetCollection{
				position:fixed;
				width: 10vw;
				height:100%;
				padding:0;
				margin:0;
				overflow-y: scroll;
				overflow-x: hidden;
			}

			#widgetCollection>li{
				list-style-type: none;
				padding: 0.5em;
				border-bottom:1px solid silver
			}

			#toolbar{
				position:fixed;
				top:0;
				right:0;
			}

			#toolbar button{
				display: inline-block;
				opacity: 0.5;
				z-index: 9999;
			}

			#toolbar:hover button{
				opacity: 1;
			}

			.custom-selected{

			}

			.ui-resizable>.ui-resizable-handle{
				pointer-events: none;
				background: rgba(0,0,0,0.0);
			}

			.custom-selected.ui-resizable>.ui-resizable-handle{
				pointer-events: auto;
				background: rgba(0,0,0,0.5);
			}






			/*JQUERY UI Modifacations, makes handles inkscape-style*/
			.ui-selected { background: #F39814; color: white; }


			.ui-resizable-handle{width:8px !important; height: 8px !important;} /*all handles*/

			.ui-resizable-n{left: calc(50% - 4px); top:-5px}
			.ui-resizable-e{right:-5px; top:calc(50% - 4px)}
			.ui-resizable-s{left:calc(50% - 4px); bottom:-5px}
			.ui-resizable-w{left:-5px; top:calc(50% - 4px)}
			.ui-resizable-ne{right:-5px;top:-5px}
			.ui-resizable-se{right:-5px;bottom: -5px;}
			.ui-resizable-sw{left:-5px; bottom:-5px;}
			.ui-resizable-nw{left:-5px; top:-5px;}
		</style>

		<!--elements -->
		<style>
			/*all*/
			.newMockElement, .mockElement{
				box-sizing: border-box;
				font-family: 'Comic Sans MS', 'Comic Sans', cursive;
			}
			.newMockElement > div:editableArea, .mockElement > div.editableArea{
				width: 100%;
				box-sizing: border-box;
			}
			/*buttons*/
			.newMockElement.button, .mockElement.button{
				justify-content: center;
				align-items: center;
				display: flex;
			}

			/*Window*/


			/*tabs*/
			.newMockElement.tabs, .mockElement.tabs{
				background: rgba(0,0,0,0);
				width:30em;
			}

			.newMockElement.tabs .editableArea, .mockElement.tabs .editableArea{
				border-bottom: 2px solid gray;
				background: rgba(0,0,0,0);
				box-sizing: border-box;
				width:100%;
				margin:0;
			}

			.newMockElement.tabs .editableArea ul, .mockElement.tabs .editableArea ul{
				box-sizing: border-box;
				width:100%;
				margin:0;
				padding:0;

			}

			.newMockElement.tabs ul li, .mockElement.tabs ul li{
				display: inline-block;
				padding: 5px 16px;
				margin: 0px;
				border: 1px solid gray;
				border-top-left-radius: 3px;
				border-top-right-radius: 3px;
				margin-bottom: -2px;
				font-family: 'Comic Sans MS', 'Comic Sans', cursive;
				position: relative;
			}


			/*menu*/

			/*headline*/

			/*table*/
			.newMockElement.table, .mockElement.table{
				width:10em;
			}
			.newMockElement.table table, .mockElement.table table{
				width: 100%;
				border-collapse: collapse;
			}
			.newMockElement.table table td, .mockElement.table table td, .newMockElement.table table th, .mockElement.table table th{
				border: 1px solid gray;
			}

			.newMockElement.table table th, .mockElement.table table th{
				border-bottom: 2px solid black;
			}

			/*just a rectangle*/
			.newMockElement.rect , .mockElement.rect{
				border:2px solid #333;
				width:200px;
				height:200px;
			}

			/*optionlist*/
			.newMockElement.optionRadiobutton , .mockElement.optionRadiobutton{
				box-sizing: border-box;
			}

			.newMockElement.optionRadiobutton .editableArea, .mockElement.optionlist .editableArea{
				box-sizing: border-box;
				width:100%;
			}

			.newMockElement.optionRadiobutton .editableArea em:before, .mockElement.optionRadiobutton .editableArea em:before{
				content:"○ ";
				font-size:1em;
			}

			.newMockElement.optionRadiobutton .editableArea strong:before, .mockElement.optionRadiobutton .editableArea strong:before{
				content:"◉ ";
				font-size:1em;
			}

			.newMockElement.optionCheckbox .editableArea em:before, .mockElement.optionCheckbox .editableArea em:before{
				content:"☐ ";
				font-size:1em;
			}

			.newMockElement.optionCheckbox .editableArea strong:before, .mockElement.optionCheckbox .editableArea strong:before{
				content:"☒ ";
				font-size:1em;
			}
	</style>
</head>

<body>
	<ul id="widgetCollection">
		<li>
			<div class="newMockElement" style="
				justify-content: center;
				align-items: center;
				display: flex;
				border:2px solid #333;
				border-radius:3px;
				font-family: 'Comic Sans MS', 'Comic Sans', cursive;
				background-white;
				width: 8em;
				height:3em;
				">
				<span class="editableArea" data-markdown-content="OK">OK</span>
			</div>
		</li>
		<li><!-- Dialog Window -->
			<div class="newMockElement dialogWindow" data-markdown-content="myWindow"
			style="
				border:2px solid gray;
				border-radius:3px;
				width: 400px;
				height:200px;
				font-family: 'Comic Sans MS', 'Comic Sans', cursive;
				">
				<div style="
					background-color:silver;
					border-bottom: 2px solid #333;
					border-radius: 3px;
					padding:7px;
					height:1.6em;
				">
					<span class="editableArea" style="float:left; padding:4px;" >Titel</span>
					<span style="padding:4px; font-size:1.5em; margin-top: -0.4em; float:right;">×</span>
				</div>
			</div>
		</li>
		<li><!-- Tabs -->
			<div class="newMockElement tabs" data-markdown-content="
* Tab1
* Tab2
			">
				<div class="editableArea" >
					<ul>
						<li>Tab1</li>
						<li>Tab2</li>
					</ul>

				</div>
			</div>
		</li>
		<li>
			<div class="newMockElement" data-markdown-content="headline1">
				<h1 class="editableArea">Headline1</h1>
			</div>
		</li>
		<li>
			<div class="newMockElement" data-markdown-content="
Testparagraphy. Look, a

* List
* List2

(markdown supported!)">
				<p class="editableArea">
					Paragraph
				</p>
			</div>
		</li>
		<li>
		<div class="newMockElement table" data-markdown-content="
| h1    |    h2   |      h3 |
|:------|:-------:|--------:|
| 100   | [a][1]  | ![b][2] |
| *foo* | **bar** | ~~baz~~ |
			">
			<div class="editableArea">
				<table><thead>
				<tr>
				<th style="text-align:left;">h1</th>
				<th style="text-align:center;">h2</th>
				</tr>
				</thead>

				<tbody>
				<tr>
				<td style="text-align:left;">100</td>
				<td style="text-align:center;">[a][1]</td>
				</tr>
				</tbody></table>
			</div>
	</div>
		</li>
		<li>
			<div class="newMockElement rect">
			</div>
		</li>
		<li>
			<div class="newMockElement optionCheckbox" data-markdown-content="**radio button**
*checkbox*
*other checkbox*">
				<div class="editableArea"></div>
			</div>
			<div class="newMockElement optionRadiobutton" data-markdown-content="**radio button**
*checkbox*
*other checkbox*">
				<div class="editableArea"></div>
			</div>
		</li>
		<li>
			<div class="newMockElement">
				<p>
					Lorem <br> Ipsum <br> dolor
				</p>
			</div>
		</li>


	</ul>
	<div id="container">

	<div id="toolbar"><button class="delete-element-button">delete Element</button></div>
	</div>
<script>
$(function(){
	var makeMovableElement = function(element){

		$(element).draggable({
			distance: 4,
			disabled:false,
			revert:"invalid",
			zIndex: 999
		}).resizable({
			handles:"all"
		});

		makeDropableElement(element);
		element.editText();
		makeSelectableElement(element);
	}



	var makeDropableElement= function(element){
		$(element).droppable({
		accept: ".mockElement, .newMockElement",
		tolerance: "fit",
		greedy: true, //you can only attach it to one element, otherwise every nested dropable recieves
		drop: function( event, ui ) {
			//calculate offset of both
			var elementToAppend = null;

			if(ui.draggable.hasClass("newMockElement")){//if this is a new element
				elementToAppend = ui.draggable.clone(false)
				elementToAppend.removeClass("newMockElement");

				elementToAppend.addClass("mockElement")
				elementToAppend.css("position","absolute");//always has relative otherwise = glitches
			}else{
				elementToAppend = ui.draggable;
			}

			var draggableOffset = ui.helper.offset(); //was ui.draggable
			var droppableOffset = $(this).offset();

			var newLeft =  draggableOffset.left - droppableOffset.left;
			var newTop = draggableOffset.top -  droppableOffset.top;

			elementToAppend.appendTo($(this)).css({top:newTop+"px", left:newLeft+"px"});
			makeMovableElement(elementToAppend);
			}
		});//droppable End
	}//droppableWrapper End

	var makeSelectableElement = function(element,selectorCanvasParam){
		var $element = $(element);

		var selectorCanvas = selectorCanvasParam ? selectorCanvasParam : "body"; //if selectorCanvas is defined, set it to a standard value

		var selectedClassParam = "custom-selected";
		var elementSelector = ".mockElement"

		var $canvas = $(selectorCanvas);

		$element.mousedown(function(event){


			if($(event.target).closest(elementSelector)[0] === $element[0]){ //either it is the same element that was clicked, or the element is the clicked element’s the first parent that is a mock element.

			// ist das Element das nächste parent element vom geklickten element aus: select.
			// wenn nicht... dann nix.
				$canvas.find("." + selectedClassParam).removeClass(selectedClassParam);

				$element.addClass(selectedClassParam); /*custom selected, since there is a jQuery UI selected, that might be used later*/
			}
		});
	}

	var deleteElement = function(){
		var canvasSelector = "body";
		var element2BDeletedSelector = ".custom-selected";
		$canvas = $(canvasSelector);

		$canvas.find(element2BDeletedSelector).remove();
	}

/*	var makeEditableElement = function(element){
		var converter = new showdown.Converter();

		var $element = $(element);
		var $textarea;

		$element.dblclick(function(event){
			event.stopPropagation();//otherwise all parent elements go to edit too.
			if($element.hasClass("isEditing")){
				leaveEditMode();
			} else {
				goToEditMode();
			}
		});


		var goToEditMode = function(){
			var markdown = $element.attr("data-markdown-content");


			//write to edit window
			$textarea = $("<textarea>",{
				class:"markdowninput",
				text: markdown
			}).appendTo($element);

			$element.addClass("isEditing");
		}

		var leaveEditMode = function(){
			var markdown = $element.find(".markdowninput").val(); //reads what the user wrote
			var html = converter.makeHtml(markdown); //convert to html

			//write markdown to data attribute
			$element.attr("data-markdown-content",markdown);

			//write content
			$element.
				find(".editableArea").
				first(). //saveguard if there are multiple editable Areas
				html(html);

			$element.removeClass("isEditing");

			$element.find(".markdowninput").remove();
		}

	};*/
	var setupGUI = function(){
		$("#toolbar .delete-element-button").click(deleteElement)
		Mousetrap.bind('del', function() { deleteElement()});

		makeDropableElement("#container");
	};

	setupGUI();

	$(".mockElement").each(function(index, element){
		makeMovableElement(element);
	});

	$(".newMockElement").draggable({
		distance: 4,
		disabled:false,
		appendTo: "body",
		helper:"clone",
		revert:"invalid",
		zIndex:999
	});
});

	</script>

</body>

</html>
