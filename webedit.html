<!--
TODO:
* Meta Elements: Note (shrinkwrapping/scrolling Text), Headline to link to, possibly via an automatic TOC dropdown menu.
* clear seperation of interactive and non interactive elements. GUI should be hidden in markup but made visible when external javascript is present. Thus: gui Javascript can go to a file.
Thus: element CSS and essential displaying stuff-css must remain in the file.

DONE:
* löschen
* Rudmentäres Editieren
* Drag/Drop schachteln
* Drag Drop
* Resize
* set up simple, universal markup that helps to style tables etc. via markdown
* meaningful positioning of the text-edit element via pos. absolute
* Change canvas size
* activate/Deactivate markdown parsing for each element type (when markdown, server textarea, otherwise simple input): Simple parsing now activated via editableContent-plaintext to the editableArea


--->


<!DOCTYPE html>
<html>

<head>
		<title>Edittests</title>
		<meta charset="UTF-8">
		<meta name="description" content="">
		<meta name="keywords" content="">
		<script src="jquery.js"></script>
		<script src="jquery-ui.js"></script>
		<script src="showdown.js"></script>
		<script src="showdownUIExtensions.js"></script>
		<script src="mousetrap.js"></script>

		<script src="jqUiEditMD2HTML.js"></script>


		<link href="jquery-ui.css" rel="stylesheet">


		<style>
				body{
			padding:0;
			margin:0;

		}

		.mockElement {

			width: 50px;
			height: 50px;
			position: absolute;
		}

		.editableArea>p{
			margin: 0 0 0 0;
			padding: 0 0 0 0;
		}

		.newMockElement{
			/*background: gray;*/
			width: 50px;
			height: 50px;
			/*position: absolute; not needed*/
		}

			.bigmockElement{
				width: 100px;
				height: 100px;
				position: absolute;
				background: #a29eb2;
			}

			#container{
				position: absolute;
				margin:0 0 0 10vw;
				padding:0 0 0 0;
				width:90vw;
				height:100vh;

			}

			#widgetCollection{
				position:fixed;
				width: 10vw;
				height:100%;
				padding:0;
				margin:0;
				overflow-y: scroll;
				overflow-x: hidden;
			}

			#widgetCollection>li{
				list-style-type: none;
				padding: 0.5em;
				border-bottom:1px solid silver
			}

			#toolbar{
				position:fixed;
				top:0;
				right:0;
			}

			#toolbar button{
				display: inline-block;
				opacity: 0.5;
				z-index: 9999;
			}

			#toolbar:hover button{
				opacity: 1;
			}

			.custom-selected{

			}

			.ui-resizable>.ui-resizable-handle{
				pointer-events: none;
				background: rgba(0,0,0,0.0);
			}

			.custom-selected.ui-resizable>.ui-resizable-handle{
				pointer-events: auto;
				background: rgba(0,0,0,0.5);
			}


			.dialog{display: none;} /*hide dialog markup*/



			/*JQUERY UI Modifacations, makes handles inkscape-style*/
			.ui-selected { background: #F39814; color: white; }


			.ui-resizable-handle{width:8px !important; height: 8px !important;} /*all handles*/

			.ui-resizable-n{left: calc(50% - 4px); top:-5px}
			.ui-resizable-e{right:-5px; top:calc(50% - 4px)}
			.ui-resizable-s{left:calc(50% - 4px); bottom:-5px}
			.ui-resizable-w{left:-5px; top:calc(50% - 4px)}
			.ui-resizable-ne{right:-5px;top:-5px}
			.ui-resizable-se{right:-5px;bottom: -5px;}
			.ui-resizable-sw{left:-5px; bottom:-5px;}
			.ui-resizable-nw{left:-5px; top:-5px;}

			.drop-hover{
				outline:2px solid rgba(0,0,0,0.3);
			}
		</style>

		<!--elements -->
		<style>
			/*all*/
			.newMockElement, .mockElement{
				box-sizing: border-box;
				font-family: 'Comic Sans MS', 'Comic Sans', cursive;
			}
			.newMockElement > div:editableArea, .mockElement > div.editableArea{
				width: 100%;
				box-sizing: border-box;
			}
			/*buttons*/
			.newMockElement.button, .mockElement.button{
				justify-content: center;
				align-items: center;
				display: flex;
			}

			/*Window*/


			/*tabs*/
			.newMockElement.tabs, .mockElement.tabs{
				background: rgba(0,0,0,0);
				width:30em;
			}

			.newMockElement.tabs>.editableArea, .mockElement.tabs>.editableArea{
				border-bottom: 2px solid gray;
				background: rgba(0,0,0,0);
				box-sizing: border-box;
				width:100%;
				margin:0;
			}

			.newMockElement.tabs>.editableArea ul, .mockElement.tabs>.editableArea ul{
				box-sizing: border-box;
				width:100%;
				margin:0;
				padding:0;

			}

			.newMockElement.tabs ul li, .mockElement.tabs ul li{
				display: inline-block;
				padding: 5px 16px;
				border: 1px solid gray;
				border-top-left-radius: 3px;
				border-top-right-radius: 3px;
				margin: 0 0 -2px 0.3em;
				font-family: 'Comic Sans MS', 'Comic Sans', cursive;
			}

			.mockElement.tabs ul li.item-highlighted{
				background: #DDD;
			}

			/*menu*/

			/*headline*/

			/*table*/
			.newMockElement.table, .mockElement.table{
				width:10em;
			}
			.newMockElement.table table, .mockElement.table table{
				width: 100%;
				border-collapse: collapse;
			}
			.newMockElement.table table td, .mockElement.table table td, .newMockElement.table table th, .mockElement.table table th{
				border: 1px solid gray;
			}

			.newMockElement.table table th, .mockElement.table table th{
				border-bottom: 2px solid black;
			}

			/*just a rectangle*/
			.newMockElement.rect , .mockElement.rect{
				border:2px solid #333;
				width:200px;
				height:200px;
			}

			/*optionlist*/
			.newMockElement.optionRadiobutton , .mockElement.optionRadiobutton{
				box-sizing: border-box;
			}

			.newMockElement.optionRadiobutton .editableArea, .mockElement.optionlist .editableArea{
				box-sizing: border-box;
				width:100%;
			}


			/*Dropdown*/
			.dropdownList{
				border:2px solid gray;
				border-radius: 3px;
				padding: 0px 0 0px 0.4em;
				display: table;
			}

			.dropdownList .editableArea{
				display: table-cell;
				text-align: center;
				height: 100%;
				vertical-align: middle;
			}

			.dropdownList .mockelement-dropdown-arrow{
				border-left: 1px solid rgb(128, 128, 128);
				padding: 0px 0.4em;
				display: table-cell;
				text-align: center;
				height: 100%;
				vertical-align: middle;
				background: #EEE;


			}

			/*loading indicator*/
			.newMockElement.loadingIndicator,
			.mockElement.loadingIndicator{
				border: 1px solid gray;
				border-radius: 2px;
				background-color: white;
				padding: 0;
				justify-content: center;
				align-items: center;
				display: flex;
				position: relative
			}

			.newMockElement.loadingIndicator .bar,
			.mockElement.loadingIndicator .bar{
				 margin: 0;
					background-color: rgba(0, 0, 0, 0.21);
				width: 70%;
				display: block;
				position: absolute;
				height: 100%;
				top: 0;
				left: 0;
				text-align: center;
			}

			/*entries vertical*/
			.newMockElement.entries-horizontal, .mockElement.entries-horizontal{
				background: rgba(0,0,0,0);
				width:30em;
			}

			.newMockElement.entries-horizontal .editableArea, .mockElement.entries-horizontal .editableArea{
				background: rgba(0,0,0,0);
				box-sizing: border-box;
				width:100%;
				height: 100%;
				margin:0;
			}

			.newMockElement.entries-horizontal .editableArea ul, .mockElement.entries-horizontal .editableArea ul{
				box-sizing: border-box;
				width:100%;
				height: 100%;
				margin:0;
				padding:0;
				display: table;
				border-collapse: collapse;
			}

			.newMockElement.entries-horizontal ul li, .mockElement.entries-horizontal ul li{
				display: table-cell;
				padding: 0.2em;
				border: 1px solid gray;
				border-collapse: collapse;
				margin: 0;
				font-family: 'Comic Sans MS', 'Comic Sans', cursive;
				text-align: center;
				vertical-align: middle;
			}

			.mockElement.entries-horizontal ul li.item-highlighted{
				background: #DDD;
			}

			/*entries horizontal*/
			.newMockElement.entries-vertical, .mockElement.entries-vertical{
				background: rgba(0,0,0,0);
				width:30em;
			}

			.newMockElement.entries-vertical .editableArea, .mockElement.entries-vertical .editableArea{
				background: rgba(0,0,0,0);
				box-sizing: border-box;
				width:100%;
				height: 100%;
				margin:0;
			}

			.newMockElement.entries-vertical .editableArea ul, .mockElement.entries-vertical .editableArea ul{
				box-sizing: border-box;
				width: 100%;
				height: 100%;
				margin: 0px;
				padding: 0px;
				display: flex;
				flex-direction: column;
			}

			.newMockElement.entries-vertical ul li, .mockElement.entries-vertical ul li{
				margin: 0px;
				font-family: "Comic Sans MS","Comic Sans",cursive;
				width: 99%;
				padding: 0.2em;
				flex: 1 1 100%;
				display: flex;
				flex-direction: row;
				align-items: center;
				justify-content: center;
				border: 1px solid rgb(128, 128, 128);
				border-collapse: collapse;
				margin-top: -1px;
			}

			.mockElement.entries-vertical ul li.item-highlighted{
				background: #DDD;
			}


			/*boxes vertical*/
			.newMockElement.boxes-horizontal, .mockElement.boxes-horizontal{
				background: rgba(0,0,0,0);
				width:30em;
			}

			.newMockElement.boxes-horizontal .editableArea, .mockElement.boxes-horizontal .editableArea{
				background: rgba(0,0,0,0);
				box-sizing: border-box;
				width:100%;
				height: 100%;
				margin:0;
			}

			.newMockElement.boxes-horizontal .editableArea ul, .mockElement.boxes-horizontal .editableArea ul{
				box-sizing: border-box;
				width: 100%;
				height: 100%;
				margin: 0px;
				padding: 0px;
				display: flex;
				flex-direction: row;
			}

			.newMockElement.boxes-horizontal ul li, .mockElement.boxes-horizontal ul li{
				padding: 0.2em;
				border: 1px solid rgb(128, 128, 128);
				font-family: "Comic Sans MS","Comic Sans",cursive;
				margin: 0.2em;
				display: flex;
				flex: 1 1 auto;
				align-items: center;
				justify-content: center;
			}

			.mockElement.boxes-horizontal ul li.item-highlighted{
				background: #DDD;
			}

			/*boxes vertical*/
			.newMockElement.boxes-vertical, .mockElement.boxes-vertical{
				background: rgba(0,0,0,0);
				width:30em;
			}

			.newMockElement.boxes-vertical .editableArea, .mockElement.boxes-vertical .editableArea{
				background: rgba(0,0,0,0);
				box-sizing: border-box;
				width:100%;
				height: 100%;
				margin:0;
			}

			.newMockElement.boxes-vertical .editableArea ul, .mockElement.boxes-vertical .editableArea ul{
				box-sizing: border-box;
				width: 100%;
				height: 100%;
				margin: 0px;
				padding: 0px;
				display: flex;
				flex-direction: column;
			}

			.newMockElement.boxes-vertical ul li, .mockElement.boxes-vertical ul li{
				margin: 4% 0 0 0;
				font-family: "Comic Sans MS","Comic Sans",cursive;
				width: 99%;
				padding: 0.2em;
				flex: 1 1 100%;
				display: flex;
				flex-direction: row;
				align-items: center;
				justify-content: center;
				border: 1px solid rgb(128, 128, 128);
				border-collapse: collapse;
			}

			.mockElement.boxes-vertical ul li.item-highlighted{
				background: #DDD;
			}

		/*meta: note*/
		.newMockElement.note, .mockElement.note{
		background: #f7ee9e;
		background: linear-gradient(to bottom, #f7ee9e 0%,#e0d68f 99%);
		border: 0px none;
		box-shadow: 5px 5px 7px rgba(0, 0, 0, 0.4);
		transform: rotate(-3deg);
		width:150px;
		height:150px;
		}

		.newMockElement.note > *, .mockElement.note > *{
			transform: rotate(3deg); /*so the text is not rotated*/
		}

		.newMockElement.note .editableArea, .mockElement.note .editableArea{
			padding:0.5em;
		}
	</style>
</head>

<body>
	<ul id="widgetCollection">
		<!--

		Tentative Description for creating elements:

			In each list Element goes a div. This Div is the Interface Element which can be dragged to the canvas.
			Each element has the class "newMockElement". This is changed to "mockElement" when it is added to the cavas.
			Also each element can have other classes.

			In the Div there can be other nested elements.

			One of these elements *can* hold text that can be edited.  This is done by adding the attribute "data-editablearea" to this element.

			The way the text is edited can be customized, by adding the attribute data-editable-mode= to it. The attribute can have the following values: "markdown", "uielements", "plain". If you set nothing, markdown is assumed.

			markdown: Is markdown with a table extension and the possibility to create radiobuttons via "(x)" and checkboxes via [x]
			uielements: for creating lists where the items are spereated by a ";". List items can be made "active" by adding a "*" in front: "normal; normal; *I am Active; normal item again; …"
			plain: plain text

			DONT:
			* give the element and id. IDs are unique and we want to be able to add multiple instances of the element to the canvas. Also, the id is set by the program anyway.



		-->

		<li>
			<div class="newMockElement" style="
				justify-content: center;
				align-items: center;
				display: flex;
				border:2px solid #333;
				border-radius:3px;
				font-family: 'Comic Sans MS', 'Comic Sans', cursive;
				background-white;
				width: 8em;
				height:3em;
				">
				<span class="editableArea" data-editable-content="OK" data-editable-mode="plain">OK</span>
			</div>
			<p class="description-newMockElement">Button</p>
		</li>
		<li><!-- Dialog Window -->
			<div class="newMockElement dialogWindow" data-editable-content="myWindow"
			style="
				border:2px solid gray;
				border-radius:3px;
				width: 400px;
				height:200px;
				font-family: 'Comic Sans MS', 'Comic Sans', cursive;
				">
				<div style="
					background-color:silver;
					border-bottom: 2px solid #333;
					border-radius: 3px;
					padding:7px;
					height:1.6em;
				">
					<span class="editableArea" style="float:left; padding:4px;" >Titel</span>
					<span style="padding:4px; font-size:1.5em; margin-top: -0.4em; float:right;">×</span>
				</div>
			</div>
		</li>
		<li><!-- Tabs -->
			<div class="newMockElement tabs" data-editable-content="Tab1;*Tab2; Tab3" data-editable-mode="uielements">
				<div class="editableArea" >
					<ul>
						<li>Tab1</li>
						<li>Tab2</li>
					</ul>

				</div>
			</div>
		</li>
		<li>
			<div class="newMockElement" data-editable-content="headline1">
				<h1 class="editableArea">Headline1</h1>
			</div>
		</li>
		<li>
			<div class="newMockElement" data-editable-content="
Testparagraphy. Look, a

* List
* List2

(markdown supported!)">
				<p class="editableArea">
					Paragraph
				</p>
			</div>
		</li>
		<li>
		<div class="newMockElement table" data-editable-content="
| h1    |    h2   |      h3 |
|:------|:-------:|--------:|
| 100   | [a][1]  | ![b][2] |
| *foo* | **bar** | ~~baz~~ |
			">
			<div class="editableArea">
				<table><thead>
				<tr>
				<th style="text-align:left;">h1</th>
				<th style="text-align:center;">h2</th>
				</tr>
				</thead>

				<tbody>
				<tr>
				<td style="text-align:left;">100</td>
				<td style="text-align:center;">[a][1]</td>
				</tr>
				</tbody></table>
			</div>
	</div>
		</li>
		<li>
			<div class="newMockElement rect">
			</div>
		</li>
		<li>
			<div class="newMockElement optionCheckbox" data-editable-content="**radio button**
*checkbox*
*other checkbox*">
				<div class="editableArea"></div>
			</div>
			<div class="newMockElement optionRadiobutton" data-editable-content="**radio button**
*checkbox*
*other checkbox*">
				<div class="editableArea"></div>
			</div>
		</li>
		<li>
			<div class="newMockElement dropdownList" data-editable-content="DropdownTitle">
				<span class="editableArea editableContent-plaintext">Dropdown Title</span><span class="mockelement-dropdown-arrow">▾</span>
			</div>
		</li>
		<li>
			<div class="newMockElement loadingIndicator" data-editable-content="50%" data-editable-mode="plain">
				<div class="bar"></div>
				70%
			</div>
		</li>
		<li>
			<div class="newMockElement entries-horizontal" data-editable-content="entry1;entry2;*entry3" data-editable-mode="uielements">
				<div class="editableArea" >
					<ul>
						<li>Entry1</li>
						<li>Entry2</li>
					</ul>
				</div>
			</div>
		</li>
		<li>
			<div class="newMockElement entries-vertical" data-editable-content="entry1;entry2;*entry3" data-editable-mode="uielements">
				<div class="editableArea" >
					<ul>
						<li>Entry1</li>
						<li>Entry2</li>
					</ul>
				</div>
			</div>
		</li>
		<li>
			<div class="newMockElement boxes-horizontal" data-editable-content="entry1;entry2;*entry3" data-editable-mode="uielements">
				<div class="editableArea" >
					<ul>
						<li>Entry1</li>
						<li>Entry2</li>
					</ul>
				</div>
			</div>
		</li>
		<li>
			<div class="newMockElement boxes-vertical" data-editable-content="entry1;entry2;*entry3" data-editable-mode="uielements">
				<div class="editableArea" >
					<ul>
						<li>Entry1</li>
						<li>Entry2</li>
					</ul>
				</div>
			</div>
		</li>

		<li>
			<div class="newMockElement meta-element note" data-editable-content="Notes here!" data-editable-mode="markdown">
				<div class="editableArea" >
				</div>
			</div>
		</li>


	</ul>


	<div id="container">

	</div>

	<div id="toolbar">
		<button class="delete-element-button">delete Element</button>
		<button class="change-canvasize-button">change Canvas Size</button>
	</div>

	<div id="changeCanvasSizeDialog" class="dialog">
		<p>Change the size of the Canvas</p>
		<label>Width:<br><input type="text" name="width"></label><br>
		<label>Height:<br><input type="text" name="height"></label>

	</div>
<script>
$(function(){
	var makeMovableElement = function(element){

		$(element).draggable({
			distance: 4,
			disabled:false,
			revert:"invalid",
			zIndex: 999
		}).resizable({
			handles:"all"
		});
	}

	var setupElement = function(element){
		makeMovableElement(element);
		makeDropableElement(element);
		$(element).editText();
		makeSelectableElement(element,"#container");
	}

	var makeDropableElement= function(element){
		$(element).droppable({
		accept: ".mockElement, .newMockElement",
		tolerance: "fit",
		greedy: true, //you can only attach it to one element, otherwise every nested dropable recieves
		hoverClass: "drop-hover",
		drop: function( event, ui ) {
			//calculate offset of both
			var elementToAppend = null;

			if(ui.draggable.hasClass("newMockElement")){//if this is a new element
				elementToAppend = ui.draggable.clone(false)
				elementToAppend.removeClass("newMockElement");

				elementToAppend.addClass("mockElement");
				elementToAppend.css("position","absolute");//always has relative otherwise = glitches

				var idnr = parseInt(Math.random()*100000000000000); //not exactly a UUID but does the job for now.

				elementToAppend.attr("id","mockElement_"+idnr);
				//TODO: assign an id "editableArea"+idnr

				elementToAppend.find(".editableArea").first().attr("id","editableArea_"+idnr)

				setupElement(elementToAppend);
			}else{
				elementToAppend = ui.draggable;
			}

			var draggableOffset = ui.helper.offset(); //was ui.draggable
			var droppableOffset = $(this).offset();

			var newLeft =  draggableOffset.left - droppableOffset.left;
			var newTop = draggableOffset.top -  droppableOffset.top;

			elementToAppend.appendTo($(this)).css({top:newTop+"px", left:newLeft+"px"});
			}
		});//droppable End
	}//droppableWrapper End

	var makeSelectableElement = function(element,selectorCanvasParam){
		var $element = $(element);

		var selectorCanvas = selectorCanvasParam ? selectorCanvasParam : "body"; //if selectorCanvas is defined, set it to a standard value

		var selectedClassParam = "custom-selected";
		var elementSelector = ".mockElement"

		var $canvas = $(selectorCanvas);

		//deselect if canvas is clicked
		$canvas.click(function(event){
			if(event.target=== $canvas[0]){
				$canvas.find("." + selectedClassParam).removeClass(selectedClassParam);
			}
		})

		//select the this element, deselect others
		$canvas.find("." + selectedClassParam).removeClass(selectedClassParam);
		$element.addClass(selectedClassParam); /*custom selected, since there is a jQuery UI selected, that might be used later*/

		$element.mousedown(function(event){
			if($(event.target).closest(elementSelector)[0] === $element[0]){ //either it is the same element that was clicked, or the element is the clicked element’s the first parent that is a mock element.

			// ist das Element das nächste parent element vom geklickten element aus: select.
			// wenn nicht... dann nix.
				$canvas.find("." + selectedClassParam).removeClass(selectedClassParam);

				$element.addClass(selectedClassParam); /*custom selected, since there is a jQuery UI selected, that might be used later*/
			}
		});

	}

	var deleteElement = function(){
		var canvasSelector = "body";
		var element2BDeletedSelector = ".custom-selected";
		$canvas = $(canvasSelector);

		$canvas.find(element2BDeletedSelector).remove();
	}

	var setupGUI = function(){
		$("#changeCanvasSizeDialog").dialog({
			autoOpen:false,
			open: function( event, ui ) {
				var $container = $("#container");

				var currentHeight = $container.height();
				var currentWidth = $container.width();

				//show current dimensions in the input filds
				$(this).
					find('input[name="height"]').
					val(currentHeight);

				$(this).
					find('input[name="width"]').
					val(currentWidth);
			},
			buttons: [
				{
					text: "OK",
					click: function() {
					var $container = $("#container");

					$container.
						height(
							$(this).
							find('input[name="height"]')
							.val()
						);
					$container.
						width(
							$(this).
							find('input[name="width"]').
							val()
						);
					$(this).dialog( "close" );
					}
				},
				{
					text: "Cancel",
					click: function() {
						$(this).dialog( "close" );
					}
				}
			]
		});

		//setup toolbar
		///setup toolbar-delete button
		$("#toolbar .delete-element-button").click(deleteElement); //delete button
		Mousetrap.bind('del', function() { deleteElement()}); //keyboard shortcut


		$("#toolbar .change-canvasize-button").click(function(){
			$("#changeCanvasSizeDialog").dialog("open");
		});

		//setup canvas
		makeDropableElement("#container");
	};

	setupGUI();

	//setup elements already on the page
	$(".mockElement").each(function(index, element){
		$(element).find(".ui-resizable-handle").remove();//otherwise we get them twice, they are saved with the file and created again when the element is initialized
		setupElement(element);
	});

	//make new siebar elements draggabe
	$(".newMockElement").draggable({
		distance: 4,
		disabled:false,
		appendTo: "body",
		helper:"clone",
		revert:"invalid",
		zIndex:999
	});
});

	</script>

</body>

</html>
